<div class="main-content" *ngIf="user$ | async; let user">
    <section class="about">
        <app-avatar [avatarUrl]="user?.avatarUrl"></app-avatar>

        <div class="info">
            <div class="name">
                <h1>{{user.firstName}} {{user.lastName}}</h1>
            </div>
        
            <div class="buttons">
                <span *ngIf="getCurrentUser()?.id != user.id; else currentUser">
                    <span *ngIf="followed$ | async; else elseBlock">
                        <button class="button negative" mat-button (click)="onUnfollow()">
                            <mat-icon>person_remove</mat-icon>
                            <span>Unfollow</span>
                        </button>
    
                        <button mat-button class="button">
                            <span class="material-icons">chat</span>
                            <span>Message</span>
                        </button>
                    </span>

                    <ng-template #elseBlock>
                        <span *ngIf="getCurrentUser()?.id != user.id">
                            <button mat-button class="button positive" (click)="onFollow()">
                                <span class="material-icons">person_add</span>
                                <span>Follow</span>
                            </button>
            
                            <button mat-button class="button">
                                <span class="material-icons">chat</span>
                                <span>Message</span>
                            </button>
                        </span>
                    </ng-template>
                </span>
        
                <ng-template #currentUser>
                    <button mat-button class="button" (click)="openModal(editForm)">
                        <span class="material-icons">edit</span>
                        <span>Edit profile</span>
                    </button>
                </ng-template>

                <button mat-button (click)="openModal(followers)">
                    <span class="material-icons">people</span>
                    <span>Followers</span>
                </button>

                <button mat-button (click)="openModal(followees)">
                    <span class="material-icons">people</span>
                    <span>Following</span>
                </button>
        
                <ng-template #editForm>
                    <app-user-edit-form [user]="user" (editUser)="onEditUser($event)"></app-user-edit-form>
                </ng-template>

                <ng-template #followers>
                    <app-follower-list [followers]="followers$ | async"></app-follower-list>
                </ng-template>

                <ng-template #followees>
                    <app-follower-list [followers]="followees$ | async"></app-follower-list>
                </ng-template>
            </div>
        </div>
    </section>
    
    <div class="activity">
        <div class="memberships">
            <div class="orchestra">
                <h2>My orchestra</h2>
                <app-orchestra-membership [orchestraMembership]="orchestraMembership$ | async"></app-orchestra-membership>
            </div>
    
            <div class="groups">
                <h2>My groups</h2>
                <div *ngIf="groupMemberships$ | async; let groupMemberships; else noGroup">
                    <app-group-memberships [groupMemberships]="groupMemberships"></app-group-memberships>
                </div>
    
                <ng-template #noGroup>
                    <div>I'm in no groups whatsoever.</div>
                </ng-template>
            </div>
        </div>
    
        <div class="info-posts">
            <mat-tab-group>
                <mat-tab label="Info"> {{user.info}} </mat-tab>
                <mat-tab label="Posts">
                    <button mat-button (click)="openModal(postForm)">
                        <span class="material-icons">add</span>
                        <span>New post</span>
                    </button>

                    <ng-template #postForm>
                        <app-post-form (post)="onSavePost($event)"></app-post-form>
                    </ng-template>

                    <app-post-list 
                        (deletePost)="onDeletePost($event)"
                        (comment)="onComment($event)" 
                        (editPost)="onEditPost($event)"
                        [currentUser]="getCurrentUser()" 
                        [posts]="posts$ | async"
                    >
                    </app-post-list>

                
                </mat-tab>

                <mat-tab label="Events"> 
                    <button mat-button (click)="openModal(eventForm)">
                        <span class="material-icons">add</span>
                        <span>New event</span>
                    </button>

                    <ng-template #eventForm>
                        <app-event-form
                            (eventFormData)="onSaveEvent($event)"
                        >
                        </app-event-form>
                    </ng-template>

                    <app-event-list
                        (editEvent)="onEditEvent($event)"
                        (deleteEvent)="onDeleteEvent($event)"
                        (joinEventId)="onJoinEvent($event)"
                        (quitEventId)="onQuitEvent($event)"
                        [events]="events$ | async"
                        [joined$]="joined$"
                        [currentUser]="getCurrentUser()"
                    >
                    </app-event-list>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>
    
</div>



